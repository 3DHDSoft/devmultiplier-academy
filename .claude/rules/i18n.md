# i18n Rules

These rules apply to internationalization in the DevMultiplier Academy platform.

## Overview

- **Library**: next-intl
- **Default Locale**: `en`
- **Database**: `*_translations` tables for content

## Translation Files

```
üì¶ src/i18n/
‚îú‚îÄ‚îÄ üìÑ config.ts              # Locale configuration
‚îú‚îÄ‚îÄ üìÑ request.ts             # Server-side setup
‚îî‚îÄ‚îÄ üìÅ messages/
    ‚îú‚îÄ‚îÄ üìÑ en.json            # English (base)
    ‚îú‚îÄ‚îÄ üìÑ es.json            # Spanish
    ‚îî‚îÄ‚îÄ üìÑ fr.json            # French
```

## Key Naming Conventions

### Structure

```json
{
  "namespace": {
    "key": "Value",
    "nestedNamespace": {
      "key": "Value"
    }
  }
}
```

### Naming Rules

```json
{
  "auth": {
    "login": "Sign In",
    "loginButton": "Sign In",
    "loginError": "Invalid credentials"
  },
  "dashboard": {
    "title": "Dashboard",
    "welcomeMessage": "Welcome back, {name}!"
  },
  "courses": {
    "enrolled": "{count, plural, =0 {No students} =1 {1 student} other {# students}}"
  }
}
```

- Use **camelCase** for keys
- Group by **feature/page** namespace
- Use **descriptive** names
- Add **suffix** for context: `Button`, `Error`, `Title`, `Message`

## Using Translations

### Server Components

```typescript
import { getTranslations } from 'next-intl/server';

export default async function Page() {
  const t = await getTranslations('dashboard');

  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('welcomeMessage', { name: user.name })}</p>
    </div>
  );
}
```

### Client Components

```typescript
'use client';

import { useTranslations } from 'next-intl';

export function CourseCard({ course }: Props) {
  const t = useTranslations('courses');

  return (
    <div>
      <h2>{course.title}</h2>
      <p>{t('enrolled', { count: course.enrollmentCount })}</p>
    </div>
  );
}
```

## ICU Message Format

### Variables

```json
{
  "greeting": "Hello, {name}!"
}
```

```typescript
t('greeting', { name: 'John' }) // "Hello, John!"
```

### Pluralization

```json
{
  "items": "{count, plural, =0 {No items} =1 {1 item} other {# items}}"
}
```

```typescript
t('items', { count: 0 })  // "No items"
t('items', { count: 1 })  // "1 item"
t('items', { count: 5 })  // "5 items"
```

### Select (Gender, etc.)

```json
{
  "pronoun": "{gender, select, male {He} female {She} other {They}}"
}
```

## Database Content

### Translation Tables Pattern

```prisma
model course_translations {
  id          String @id
  courseId    String @db.Uuid
  locale      String              // 'en', 'es', 'fr'
  title       String
  description String
  content     String

  @@unique([courseId, locale])
  @@index([locale])
}
```

### Fetching with Locale

```typescript
const course = await prisma.course.findUnique({
  where: { id: courseId },
  include: {
    course_translations: {
      where: { locale: userLocale },
    },
  },
});

// With fallback to English
const course = await prisma.course.findUnique({
  where: { id: courseId },
  include: {
    course_translations: {
      where: {
        OR: [{ locale: userLocale }, { locale: 'en' }],
      },
      orderBy: {
        locale: userLocale === 'en' ? 'asc' : 'desc',
      },
      take: 1,
    },
  },
});

const title = course?.course_translations[0]?.title || 'Untitled';
```

## Formatting

### Dates

```typescript
import { useFormatter } from 'next-intl';

function DateDisplay({ date }: { date: Date }) {
  const format = useFormatter();

  return format.dateTime(date, {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
```

### Numbers

```typescript
format.number(1234.56, { style: 'currency', currency: 'USD' })
// "$1,234.56" (en-US)
// "1.234,56 $" (es-ES)
```

### Relative Time

```typescript
format.relativeTime(new Date(), { unit: 'day' })
// "today", "yesterday", "in 2 days"
```

## User Locale

### From Session

```typescript
const session = await auth();
const locale = session?.user?.locale || 'en';
```

### Updating Preference

```typescript
await prisma.users.update({
  where: { id: userId },
  data: { locale: newLocale },
});
```

## Best Practices

### Do

- Use namespaces to organize translations
- Use ICU format for plurals and variables
- Provide fallback to English
- Keep keys descriptive but concise
- Include context suffixes (Button, Error, Title)
- Store user locale preference in database

### Don't

- Don't hardcode user-facing strings
- Don't use string concatenation for translations
- Don't forget to add new keys to all locales
- Don't use machine translation without review
- Don't include HTML in translation strings

## Adding New Translations

1. Add key to `en.json` (base locale)
2. Add key to all other locale files
3. Use `TODO:` prefix for untranslated:
   ```json
   {
     "newKey": "TODO: Original text"
   }
   ```
4. Run `/i18n-check` to verify completeness
