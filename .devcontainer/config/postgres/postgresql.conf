# -----------------------------
# PostgreSQL 18 Configuration File
# Optimized for Docker dev container with 2GB memory limit
# -----------------------------

# CONNECTIONS AND AUTHENTICATION
listen_addresses = '*'          # Allow connections from other containers
max_connections = 100           # Reduced for dev environment
password_encryption = scram-sha-256  # Use SCRAM-SHA-256 for password hashing
ssl = off                       # Disable SSL for container-to-container communication

# RESOURCE USAGE (MEMORY) - Tuned for 2GB container
shared_buffers = 512MB          # 25% of 2GB
effective_cache_size = 1536MB   # 75% of 2GB
maintenance_work_mem = 128MB    # Memory for maintenance operations
work_mem = 16MB                 # Memory per sort operation
huge_pages = off                # Disable huge pages in containers

# WRITE-AHEAD LOG (WAL)
wal_buffers = 16MB             # WAL buffer size
min_wal_size = 256MB           # Minimum size to keep WAL
max_wal_size = 1GB             # Maximum size before checkpoint
checkpoint_completion_target = 0.9  # Spread checkpoints over 90% of interval

# QUERY TUNING
random_page_cost = 1.1          # Lower for SSD/container storage
effective_io_concurrency = 200  # Number of concurrent I/O operations
default_statistics_target = 100 # Statistics collection target

# PARALLEL QUERY - Reduced for 2 CPU limit
max_worker_processes = 4                    # Maximum background processes
max_parallel_workers_per_gather = 2         # Parallel workers per gather node
max_parallel_workers = 4                    # Maximum parallel workers
max_parallel_maintenance_workers = 2        # Parallel workers for maintenance

# LOGGING
log_destination = 'stderr'                  # Log to stderr for Docker
logging_collector = on                      # Enable log collection
log_directory = '/var/lib/postgresql/18/docker/log'  # Log directory (PostgreSQL 18+)
log_filename = 'postgresql-%Y-%m-%d.log'    # Daily log files
log_rotation_age = 1d                       # Rotate logs daily
log_rotation_size = 100MB                   # Rotate when log reaches 100MB
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '  # Detailed log format
log_timezone = 'UTC'                        # Use UTC for logs

# MODULES (Extensions)
shared_preload_libraries = 'pg_stat_statements'

# LOCALE AND FORMATTING
timezone = 'UTC'                           # Use UTC timezone
lc_messages = 'en_US.UTF-8'                # Locale for messages
lc_monetary = 'en_US.UTF-8'                # Locale for monetary formatting
lc_numeric = 'en_US.UTF-8'                 # Locale for number formatting
lc_time = 'en_US.UTF-8'                    # Locale for time formatting

# CLIENT CONNECTION DEFAULTS
default_text_search_config = 'pg_catalog.english'  # Default text search configuration
